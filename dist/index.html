<html>
<title>CA Big Tree Cluster Tracker</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20,400,1,0" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="manifest" href="/site.webmanifest" crossorigin="use-credentials">
<link rel="stylesheet" href="lib/slickgrid/slick.grid.css" type="text/css"/>
<link rel="stylesheet" href="lib/jquery-ui/jquery-ui.min.css" type="text/css"/>
<link rel="stylesheet" href="lib/slickgrid/controls/slick.pager.css" type="text/css"/>
<link rel="stylesheet" href="lib/leafletjs/leaflet.css" type="text/css"/>
<link rel="stylesheet" href="css/gridstyles.css" type="text/css"/>
<link rel="stylesheet" href="css/custom.css" type="text/css"/>
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
.w3-bar,h1,button {font-family: "Montserrat", sans-serif}
.fa-anchor,.fa-coffee {font-size:200px}
.dropdown {position: relative; display: inline-block; width: 150px}
.dropdown-content {display: none; position: absolute; z-index: 200; width: 100%; background-color:#f1f1f1; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2)} 
.timel {display: block; width: 100%; text-align: center;}
.show {display:block;}
div.hide {display: none;}
</style>
    <body>
        <div id="status_msg" class="warning hide" onclick="hideMsg()"></div>
        <div id="menuContainer" style="display:none;">
            <ul id="menuList">
                <li>
                    <div id="logout" title="Switch between authorized accounts">
                        <span class="material-symbols-outlined">switch_account</span>
                        Switch Login
                    </div>
                </li>
            </ul>
        </div>
        <div>
            <div id="btnMenuDiv">
                <div id="btnMenu" title="Show/hide menu">
                    <span class="material-symbols-outlined">menu</span>
                </div>
            </div>
            <div>
                <h1>California Big Tree Cluster Tracker </h1>
            </div>
        </div>
        <script>
            dataHost = 'https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/';
            taxoniumHost = ['https%3A%2F%2Ftaxonium.cluster-tracker.big-tree.ucsc.edu%2F', 'https%3A%2F%2Fclustertracker-california-taxonium-backend-6twdguah7a-uw.a.run.app'];
            cDataFile = 'cluster_data.json.gz';
            cSampleFile = 'sample_data.json.gz';
            ext = '';


            function showList() {
                document.getElementById("myDropdown").classList.toggle("show");
            }
            window.onclick = function(event) {
                if (!event.target.matches('.dropbtn')) {
                    var dropdowns = document.getElementsByClassName("dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
            }
        </script>
        <div class="dropdown" id="drop_SC">
            <button onclick="swap_countystate()" class="dropbtn" id="btn_SC">Show CA State Introductions</button>
        </div>
        <div class="dropdown" id="dropcolor">
            <button onclick="changeScale()" class="dropbtn" id="colorbtn" disabled>Show Raw Cluster Count</button>
        </div>
        <div class="dropdown" id="droploc">
            <button onclick="showList()" class="dropbtn">Choose Map Display Time Period</button>
            <div id="myDropdown" class="dropdown-content">
                <button id="btn_time_0" class="timel btn_selected" onclick="changeMap(0)">Whole Pandemic</p>
                <button id="btn_time_12" class="timel" onclick="changeMap(12)">Last 12 Months</p>
                <button id="btn_time_6" class="timel" onclick="changeMap(6)">Last 6 Months</p>
                <button id="btn_time_3" class="timel" onclick="changeMap(3)">Last 3 Months</p>
            </div>
        </div>
        <div id="display" title="This map displays the count of inferred unique families of the virus in each region by default. When a region is selected, it instead displays a scaled estimate of the count of viral introductions to the selected region from each other region.">
            <div id="mapid"></div>
            <style>
                #mapid {
                    height: 400px;
                }
            </style>
        </div>
        <div id="maintext">
            <p>The California Big Tree Cluster Tracker combines sequence data from the <a title="Repository containing daily-updated comprehensive global phylogenetic trees for SARS-CoV-2" target="_blank" href="https://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/">global public SARS-CoV-2 phylogenetic tree</a> and sequences in California’s central repository in Terra. The Cluster Tracker applies a <a title="Wiki page describing the heuristic calculation." target="_blank" href="https://usher-wiki.readthedocs.io/en/latest/matUtils.html#introduce">heuristic</a> to identify groups of sequences in a given region that may have recently arrived from another region. These groups may reflect cases of an infected traveler entering a region, followed by local spread. Note that biases might affect these results: relative local sequencing effort, the rate sequences arrive in repositories, and accuracy of reconstructed evolutionary relationships. You can view each <span class="definition" title="The set of sequences within a region that are inferred to result from a single introduction via travel.">cluster</span> in <a title="link to California Big Tree Investigator" href="https://investigator.big-tree.ucsc.edu/" target="_blank">CA Big Tree Investigator</a> or <a title="Github repository for the Taxonium browser tree viewer" href="https://github.com/theosanderson/taxonium" target="_blank">Taxonium</a> and perform your own analysis with UCSC’s <a title="Github repository for UShER" href="https://github.com/yatisht/usher" target="_blank">UShER</a> after downloading the output files from the link below the table.
            </p>
        </div>
        <div id="searchbox">
            <div id="accordion">
                <h3>Search</h3>
                <div class="colContainer">
                    <div class="lSide">
                        <input type="text" id="txtSearch" placeholder="Search across all columns...">
                        <button onclick="doSimpleSearch();" id="btnSimpleSearch">Search</button>
                        <button onclick="clearFilter();" id="btnClearSearch">Clear</button>
                        <div class="searchNote">
                            Separate multiple search terms with a comma. Do not use spaces between search terms.
                        </div>
                    </div>
                    <div class="rSide">
                        <span class=searchSubt>Boolean Search Options</span><br>
                        <div>
                            <input type="radio" checked="checked" name="bool" value="and" id="boolAnd">
                            <label for="boolAnd">AND (contains ALL search terms)</label>
                        </div>
                        <div>
                            <input type="radio" name="bool" value="or" id="boolOr">
                            <label for="boolOr">OR (contains ANY search term)</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="grdContainer">
            <div id="myGrid" style="width:100%;height:570px;"></div>
            <div id="pager"></div>
            <div>
                <p class="tableNote">* = Interpret with caution. Value may not be meaningful due to small cluster size, or cluster dates were not able to be parsed.</p>
            </div>
        </div>

        <script src="scripts/check_status.js"></script>

        <script src="lib/leafletjs/leaflet.js"></script>
        <script src="https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/regions.js" id="script-region"></script>
        <script src="https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/regions_us.js" id="script-region_us"></script>
        <script src="scripts/main.js" id="script-main"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>!window.jQuery && document.write('<script src="lib/jquery/jquery.min.js"><\/script>')</script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript">
           // prevents loading from browser cache
           const ver = Date.now();
           document.getElementById('script-main').src = 'scripts/main.js?v=' + ver;
           document.getElementById('script-region').src = 'https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/regions.js?v=' + ver;
           document.getElementById('script-region_us').src = 'https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/regions_us.js?v=' + ver;

           //attaches events to menu
           $( function() {
             $( "#menuList" ).menu();
           } );
           $('#btnMenu').click(function(){ 
            const el = document.getElementById("menuContainer");
            if (el.style.display == "none") {
                el.style.display = "inline";
            } else {
                el.style.display = "none";
            }
            return false; });
           $('#logout').click(function(){ window.open('?gcp-iap-mode=CLEAR_LOGIN_COOKIE', '_self'); return false;});

           //checks data update status and triggers alert if needed
           readStatus();
        </script>
        <!-- SlickGrid: core jquery libs -->
        <script src="lib/jquery-ui/jquery-ui.min.js"></script>
        <script src="lib/slickgrid/lib/jquery.event.drag-2.3.0.js"></script>
        <!-- SlickGrid: core js-->
        <script src="lib/slickgrid/slick.core.js"></script>
        <script src="lib/slickgrid/slick.grid.js"></script>
        <script src="lib/slickgrid/slick.dataview.js"></script>
        <script src="lib/slickgrid/controls/slick.pager.js"></script>
        <!-- SlickGrid: copy cells -->
        <script src="lib/slickgrid/plugins/slick.cellexternalcopymanager.js"></script>
        <script src="lib/slickgrid/plugins/slick.cellselectionmodel.js"></script>
        <script src="lib/slickgrid/plugins/slick.cellrangedecorator.js"></script>
        <script src="lib/slickgrid/plugins/slick.cellrangeselector.js"></script>
        <!-- SlickGrid: resize columns -->
        <script src="lib/slickgrid/plugins/slick.resizer.js"></script>
        <!-- Slick Grid: tool tip -->
        <script src="lib/slickgrid/plugins/slick.customtooltip.js"></script>
        <!-- Gets data and loads into Slick Grid table -->
        <script src="scripts/datagrid.js"></script>
        <script>
            // set jquery-ui accordian params
            $( function() {
                $( "#accordion" ).accordion({
                  collapsible: true,
                  heightStyle: "content"
                });
              } );
            // itialize grid
            initCTGrid(dataHost, taxoniumHost, cDataFile, cSampleFile);
        </script>

        <div id="downloads">
            Download full output file from the <a href = "https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/hardcoded_clusters.tsv", download = "sarscov2_clusters_CA_counties.tsv">California-county based analysis</a> or the <a href = "https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/hardcoded_clusters_us.tsv", download = "sarscov2_clusters_CA_state.tsv">California-state based analysis</a>.<br>
            Download the Taxonium JSONL file from the <a href = "https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/cview.jsonl.gz", download = "cluster_taxonium_CA_counties.jsonl.gz">California-county based analysis</a> or the <a href = "https://storage.googleapis.com/ucsc-gi-cdph-bigtree/display_tables/cview_us.jsonl.gz", download = "cluster_taxonium_CA_state.jsonl.gz">California-state based analysis</a> for viewing.
            <p>Please post an issue at <a title="The github repository for this site." href="https://github.com/pathogen-genomics/introduction-website" target="_blank">the github</a> or email us at help-pathogengenomics@ucsc.edu if you have questions or feedback.</p>
        </div>
    </body>
</html>